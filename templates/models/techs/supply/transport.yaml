tech_groups:
    transport_ice:
        exists: false
        essentials:
            parent: conversion
            carrier_in: diesel
        constraints:
            lifetime: 10
    transport_ev:
        exists: false
        essentials:
            parent: conversion
            carrier_in: electricity
        constraints:
            lifetime: 15
    transport_ev_time_varying:
        essentials.parent: transport_ev
        constraints:
            energy_cap_max_time_varying: file=plugin-ev.csv

techs:
    # Vehicle supply technologies
    heavy_transport_ice:
        essentials:
            name: Internal combustion engine heavy vehicles
            parent: transport_ice
            carrier_out: heavy_transport
    light_transport_ice:
        essentials:
            name: Internal combustion engine light vehicles
            parent: transport_ice
            carrier_out: light_transport
    heavy_transport_ev:
        essentials:
            name: Electric heavy vehicles
            parent: transport_ev
            carrier_out: heavy_transport
    light_transport_ev:
        essentials:
            name: Electric light vehicles
            parent: transport_ev_time_varying
            carrier_out: light_transport

    # Historical electrified road transport demand
    demand_road_transport_historic_electrified_uncontrolled:
        essentials:
            name: 'Removes historic electrified road transport demand from ENTSOE-derived historical electricity demand profile -- assumed uncontrolled'
            parent: supply
            carrier: electricity
        constraints:
            resource: file=supply/uncontrolled-road-transport-historic-electrification.csv  # TODO: think whether this timeseries should be in supply or demand folder
            force_resource: true



overrides:
    #Â Set capacities and efficiencies for vehicles, per year
    {% set unique_years = locations.columns.str[:4].unique() %}
    {% for year in unique_years %}
    {{ year }}_vehicle_parameters:
        locations:
    {% for location in locations.index %}
            {{ location }}:
                techs:
                {% for col in locations.columns if col.startswith(year) %}
                    {% if "charging_potential" in col %}
                    light_transport_ev:
                        constraints:
                            energy_cap_max: {{ locations.loc[location, col] }} # {{ (1 / scaling_factors.transport) | unit("Mio km") }}
                    {% endif %}
                    {% if "efficiency_ev_light" in col %}
                            energy_eff: {{ locations.loc[location, col] }} # {{ (scaling_factors.power / scaling_factors.transport) | unit("Miokm/MWh") }}
                    {% endif %}
                    {% if "efficiency_ev_heavy" in col %}
                    heavy_transport_ev:
                        constraints:
                            energy_eff: {{ locations.loc[location, col] }} # {{ (scaling_factors.power / scaling_factors.transport) | unit("Miokm/MWh") }}
                            # FIXME: add energy_cap_max for heavy EVs
                    {% endif %}
                    {% if "efficiency_ice_light" in col %}
                    light_transport_ice:
                        constraints:
                            energy_eff: {{ locations.loc[location, col] }} # {{ (scaling_factors.power / scaling_factors.transport) | unit("Miokm/MWh") }}
                    {% endif %}
                    {% if "efficiency_ice_heavy" in col %}
                    heavy_transport_ice:
                        constraints:
                            energy_eff: {{ locations.loc[location, col] }} # {{ (scaling_factors.power / scaling_factors.transport) | unit("Miokm/MWh") }}
                    {% endif %}
                {% endfor %}

    {% endfor %}

    {% endfor %}

    # Remove historical electrified road transport
    keep-historic-electricity-demand-from-road-transport:
      # TODO: possibly remove this override as there may be no use-cases for it.
      {% for id, location in locations.iterrows() %}
      {{ id }}.techs.demand_road_transport_historic_electrified_uncontrolled.exists: false
      {% endfor %}
